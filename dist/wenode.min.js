var proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),throwMarker=Symbol("Comlink.thrown"),isObject=e=>"object"==typeof e&&null!==e||"function"==typeof e,proxyTransferHandler={canHandle:e=>isObject(e)&&Boolean(e[proxyMarker]),serialize(e){let{port1:t,port2:r}=new MessageChannel,n=e[proxyMarker];return expose(e,t,"object"==typeof n?n:void 0),[r,[r]]},deserialize:e=>(e.start(),wrap(e))},throwTransferHandler={canHandle:e=>isObject(e)&&throwMarker in e,serialize({value:e}){let t;return[t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler],]);function expose(e,t=self,r){t.addEventListener("message",function n(i){if(!i||!i.data)return;let{id:s,type:o,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(fromWireValue),u;try{let c=(null==r?void 0:r.spec)==null,f=e,p=e,d=null==r?void 0:r.spec,y=d;for(let m of a){if(f=p,y=d,c){p=p[m];continue}if("object"==typeof d&&d.hasOwnProperty(m))p=p[m],d=d[m];else{p=void 0,d=void 0;break}}switch(o){case 0:u=p;break;case 1:{u=!1;let h=(null==r?void 0:r.set)!==!1,w=c||"primitive"===y||"primitive"===d;w||(f=void 0),(h||!w)&&(f[a.slice(-1)[0]]=fromWireValue(i.data.value),u=!0)}break;case 2:c||"function"===d||(p=void 0),u=p.apply(f,l);break;case 3:{c||(p=void 0);let g=new p(...l);u=proxy(g)}break;case 4:{let{port1:b,port2:v}=new MessageChannel;expose(e,v,r),u=transfer(b,[b])}break;case 5:u=void 0}}catch($){u={value:$,[throwMarker]:0}}Promise.resolve(u).catch(e=>({value:e,[throwMarker]:0})).then(e=>{let[r,i]=toWireValue(e);t.postMessage(Object.assign(Object.assign({},r),{id:s}),i),5===o&&(t.removeEventListener("message",n),closeEndPoint(t))})}),t.start&&t.start()}function isMessagePort(e){return"MessagePort"===e.constructor.name}function closeEndPoint(e){isMessagePort(e)&&e.close()}function wrap(e,t){return createProxy(e,[],t)}function throwIfProxyReleased(e){if(e)throw Error("Proxy has been released and is not useable")}function createProxy(e,t=[],r=function(){}){let n=!1,i=new Proxy(r,{get(r,s){if(throwIfProxyReleased(n),s===releaseProxy)return()=>requestResponseMessage(e,{type:5,path:t.map(e=>e.toString())}).then(()=>{closeEndPoint(e),n=!0});if("then"===s){if(0===t.length)return{then:()=>i};let o=requestResponseMessage(e,{type:0,path:t.map(e=>e.toString())}).then(fromWireValue);return o.then.bind(o)}return createProxy(e,[...t,s])},set(r,i,s){throwIfProxyReleased(n);let[o,a]=toWireValue(s);return requestResponseMessage(e,{type:1,path:[...t,i].map(e=>e.toString()),value:o},a).then(fromWireValue)},apply(r,i,s){throwIfProxyReleased(n);let o=t[t.length-1];if(o===createEndpoint)return requestResponseMessage(e,{type:4}).then(fromWireValue);if("bind"===o)return createProxy(e,t.slice(0,-1));let[a,l]=processArguments(s);return requestResponseMessage(e,{type:2,path:t.map(e=>e.toString()),argumentList:a},l).then(fromWireValue)},construct(r,i){throwIfProxyReleased(n);let[s,o]=processArguments(i);return requestResponseMessage(e,{type:3,path:t.map(e=>e.toString()),argumentList:s},o).then(fromWireValue)}});return i}function myFlat(e){return Array.prototype.concat.apply([],e)}function processArguments(e){let t=e.map(toWireValue);return[t.map(e=>e[0]),myFlat(t.map(e=>e[1]))]}var transferCache=new WeakMap;function transfer(e,t){return transferCache.set(e,t),e}function proxy(e,t){return Object.assign(e,{[proxyMarker]:null==t||t})}function toWireValue(e){for(let[t,r]of transferHandlers)if(r.canHandle(e)){let[n,i]=r.serialize(e);return[{type:3,name:t,value:n},i,]}return[{type:0,value:e},transferCache.get(e)||[],]}function fromWireValue(e){switch(e.type){case 3:return transferHandlers.get(e.name).deserialize(e.value);case 0:return e.value}}function requestResponseMessage(e,t,r){return new Promise(n=>{let i=generateUUID();e.addEventListener("message",function t(r){r.data&&r.data.id&&r.data.id===i&&(e.removeEventListener("message",t),n(r.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),r)})}function generateUUID(){return[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function formatFileSystemTree(e){let t={d:{}};for(let r of Object.keys(e)){let n=e[r];if("file"in n){let i=n.file.contents,s="string"==typeof i?i:binaryString(i),o="string"==typeof i?{}:{b:!0};t.d[r]={f:{c:s,...o}};continue}let a=formatFileSystemTree(n.directory);t.d[r]=a}return t}function binaryString(e){let t="";for(let r of e)t+=String.fromCharCode(r);return t}var DEFAULT_IFRAME_SOURCE="https://stackblitz.com/headless",bootPromise=null,booted=!1,destroyed=!1,decoder=new TextDecoder,encoder=new TextEncoder,WebContainer=class{constructor(e,t,r){this._endpoint=e,this._iframe=r,this.fs=new FileSystemAPIClient(t)}fs;async spawn(e,t,r){let n=[];Array.isArray(t)?n=t:r=t;let i=new ReadableStream,s;r?.output!==!1&&(i=new ReadableStream({start(e){s=t=>e.enqueue(t)}}));let o=proxyListener(optionalBinaryListener(s)),a=await this._endpoint.run({command:e,args:n,env:r?.env,terminal:r?.terminal},void 0,void 0,o);return new WebContainerProcessImpl(a,i)}on(e,t){let r=!1,n=()=>{},i=(...e)=>{!r&&t(...e)};return this._endpoint.on(e,proxy(i)).then(e=>{n=e,r&&n()}),()=>{r=!0,n()}}mount(e,t){let r=encoder.encode(JSON.stringify(formatFileSystemTree(e)));return this._endpoint.loadFiles(transfer(r,[r.buffer]),{mountPoints:t?.mountPoint})}teardown(){if(destroyed)throw Error("WebContainer already torn down");destroyed=!0,this.fs._teardown(),this._endpoint.teardown(),this._endpoint[releaseProxy](),this._iframe.remove()}static async boot(){for(;bootPromise;)await bootPromise;if(booted)throw Error("WebContainer already booted");let e=unsynchronizedBoot();bootPromise=e.catch(()=>{});try{let t=await e;return booted=!0,t}finally{bootPromise=null}}},DIR_ENTRY_TYPE_FILE=1,DIR_ENTRY_TYPE_DIR=2,DirEntImpl=class{constructor(e,t){this.name=e,this._type=t}isFile(){return this._type===DIR_ENTRY_TYPE_FILE}isDirectory(){return this._type===DIR_ENTRY_TYPE_DIR}},WebContainerProcessImpl=class{constructor(e,t){this._process=e,this.output=t,this.input=new WritableStream({write:e=>{this._process.write(e).catch(()=>{})}})}input;get exit(){return this._process.onExit}kill(){this._process.kill()}resize(e){this._process.resize(e)}},FileSystemAPIClient=class{_fs;constructor(e){this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async writeFile(e,t,r){if(t instanceof Uint8Array){let n=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=transfer(new Uint8Array(n),[n])}await this._fs.writeFile(e,t,r)}async readdir(e,t){let r=await this._fs.readdir(e,t);if(isStringArray(r)||isTypedArrayCollection(r))return r;let n=r.map(e=>new DirEntImpl(e.name,e["Symbol(type)"]));return n}async mkdir(e,t){return await this._fs.mkdir(e,t)}_teardown(){this._fs[releaseProxy]()}};async function unsynchronizedBoot(){let{iframe:e,endpointPromise:t}=endpointFactory(),r=await t,n=await r.build({host:window.location.host,version:"1.0.0"}),i=await n.fs();return r[releaseProxy](),new WebContainer(n,i,e)}function optionalBinaryListener(e){if(null!=e)return t=>{t instanceof Uint8Array&&e(decoder.decode(t))}}function proxyListener(e){if(null!=e)return proxy(e)}function endpointFactory(){let e=document.createElement("iframe");e.style.display="none",e.setAttribute("allow","cross-origin-isolated");let t=getIframeUrl();e.src=getIframeUrl().toString();let{origin:r}=t,n=new Promise(e=>{let t=t=>{if(t.origin!==r)return;let{data:n}=t;if("init"===n.type){e(wrap(t.ports[0]));return}if("warning"===n.type){console[n.level].call(console,n.message);return}};window.addEventListener("message",t)});return document.body.insertBefore(e,null),{iframe:e,endpointPromise:n}}function isStringArray(e){return"string"==typeof e[0]}function isTypedArrayCollection(e){return e[0]instanceof Uint8Array}function getIframeUrl(){return new URL(window.WEBCONTAINER_API_IFRAME_URL??DEFAULT_IFRAME_SOURCE)}function makeid(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,i=0;i<e;i++)t+=r.charAt(Math.floor(Math.random()*n));return t}(async()=>{function loop(e,t){return new Promise((r,n)=>{var i=0;let s=()=>{e[i]?t(e[i],i++,s):r(!0)};t(e[i],i++,s)})}let toBeCreated=[],allf;Array.from(document.querySelectorAll("file")).forEach((e,t)=>{e.style.display="none";let r=e.getAttribute("name");toBeCreated.push([r,e.innerHTML])});let webcontainerInstance=await WebContainer.boot();await webcontainerInstance.fs.writeFile("package.json",`{
  "name": "wenodeseven7four4replco-si0h"
}`);let fs=webcontainerInstance.fs;await loop(toBeCreated,async(e,t,r)=>{await fs.writeFile(e[0],e[1]),r()}),await loop(Array.from(document.querySelectorAll("script[type=wenode]")),async(x,_,next)=>{let spawn=async function(){let e=Array.from(arguments),t=await webcontainerInstance.spawn(...e);return t.output.pipeTo(new WritableStream({write(e){x.onoutput?x.onoutput(e):console.log(e)}})),t},pkgs=x.getAttribute("packages"),ESM=x.hasAttribute("esm")?".mjs":".js",filename=makeid(8)+ESM;if(pkgs){let installProcess=await spawn("npm",["install",...pkgs.split(" ")]),installExitCode=await installProcess.exit;if(0!==installExitCode){if(x.oninstallfail&&x.oninstallfail,x.hasAttribute("oninstallfail"))eval(x.getAttribute("oninstallfail"));else throw Error("Unable to install")}else x.oninstall&&x.oninstall(),x.hasAttribute("oninstall")&&eval(x.getAttribute("oninstall"))}let client=x.getAttribute("client");x.hasAttribute("no-autostart")?x.start=async()=>{await fs.writeFile(filename,x.innerText),await spawn("node",[filename]),webcontainerInstance.on("server-ready",(port,url)=>{client&&(document.querySelector(client).src=url),x.onserver&&x.onserver(url),x.hasAttribute("onserver")&&eval(x.getAttribute("onserver"))})}:(await fs.writeFile(filename,x.innerText),await spawn("node",[filename]),webcontainerInstance.on("server-ready",(port,url)=>{client&&(document.querySelector(client).src=url),x.onserver&&x.onserver(url),x.hasAttribute("onserver")&&eval(x.getAttribute("onserver"))})),next()})})();
